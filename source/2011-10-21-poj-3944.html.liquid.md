---
layout: post
title: "POJ 3944 - Spherical Mirrors"
---
[http://poj.org/problem?id=3944](http://poj.org/problem?id=3944)

## 概要
三次元空間に N 個の球がある．この球は図のようにレーザーを反射する．

(0,0,0) から (u,v,w) の方向にレーザーを発射したとき，最後に反射する球面上の点を答える．

## 制約
- 1 <= N <= 100
- -100 <= 座標 <= 100
- 5 <= 半径 <= 30
- u^2 + v^2 + w^2 > 0
- どの2つの球の球面も 0.1 以上離れている
- (0,0,0) はどの球にも含まれておらず，どの球面からも 0.1 以上離れている
- 光線は少なくとも1回反射し，多くとも5回しか反射しない
- 反射するときの反射角 θ は85度未満

## 解法
三次元幾何をがんばる．
ライブラリを用意できていれば特に難しい点は無い．

半直線と球の交差判定は，半直線と円の交差判定と同様に，向きを確認してから点と直線の距離が r 未満かどうかを見ればいい．

半直線と球の交点は二分探索で求めた．

反射させるときは，2回の外積で QN に関して QI とは逆方向の法線を出して，QI と QN の内積で得られた cosθ を使って QR を作った．
ただし，θ = 0 のときは QI と QN の外積が零ベクトルになってしまうので，単に入射光のベクトルを反転させたものを返すようにした．

{% include_code lang:cpp poj/3944.cc %}
