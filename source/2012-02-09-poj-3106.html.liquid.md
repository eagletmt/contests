---
layout: post
title: "POJ 3106 - Flip and Turn"
---
[http://poj.org/problem?id=3106](http://poj.org/problem?id=3106)

## 概要
`\(m\)` 行 `\(n\)` 列の行列が与えられる．
以下のような命令の列が与えられるので，命令を左から順に処理した後の行列を答える．

- `1` 左上から右下への対角線に関して転置
- `2` 右上から左下への対角線に関して転置
- `H` 行について上下反転
- `V` 列について左右反転
- `A`, `B`, `C` 時計回りの方向にそれぞれ 90度，180度，270度回転
- `X`, `Y`, `Z` 反時計回りの方向にそれぞれ 90度，180度，270度回転

## 制約
- `\(0 < m, n \le 300\)`
- `\(0 < \mbox{命令の数} \le 10^5\)`

## 解法
どの命令も行列として表現できるので命令は結合則を満たす．

どの命令も `\(A, H\)` の2つで表現できる．

- `\(1 = HA\)`
- `\(2 = HA^3\)`
- `\(V = HA^2\)`
- `\(B = A^2\)`
- `\(C = A^3\)`
- `\(X = A^3\)`
- `\(Y = A^2\)`
- `\(Z = A\)`

また `\(AH = HA^3\)` であるから，任意の命令列は `\(H^i A^j\)` という形に変形できる．
さらに明らかに `\(H^2 = I, A^4 = I\)` なので `\(0 \le i \le 1, 0 \le j \le 3\)` という8通りの命令列に変換できる．

あとはこの8通りの命令列に関して A と H での状態遷移を考えて，下図のようなオートマトンを構成して命令列を変換し，最後に実際に命令を実行すればいい．

![3106.svg](/images/poj/3106.svg)

{% include_code lang:cpp poj/3106.cc %}
