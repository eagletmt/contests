---
layout: post
title: "POJ 2047 - Concert Hall Scheduling"
---
[http://poj.org/problem?id=2047](http://poj.org/problem?id=2047)

## 概要
コンサートホールに使わせてほしいという依頼が N 個きている．

依頼は「i 日目から j 日目まで w 円で使わせてほしい」というもので，
そのコンサートホールには2つの全く同じ部屋があるため，
各依頼に対してどちらかの部屋を割り当てることができる．

利益を最大にするように依頼を受けたときの利益の答える．

## 制約
- N <= 1000
- 1 <= i <= j <= 365
- w <= 1000000

## 解法
最小費用流．

最初，日にちをノードとして依頼 x, y について「x の後に y を受けることができる」ときに x.j から y.i にエッジを張ったようなグラフを作って最小費用流を求めた．

![2047-1](/images/poj/2047-1.svg)

図は Sample Input の2つ目のケース．i 日目の開始を i, 終了を i' で表現している．

これでも解ける けど，エッジの数が N^2 程度あって遅い (AOJ 1246 において，2:34 で AC した)．

そこでエッジの張りかたを変え，すべての i について i 日目から i+1 日目に容量2のエッジを張り，
各依頼について i から j に容量1，費用 -w のエッジを張るようにした．
こうするとエッジの数は N+365*2 くらいに抑えられる．
ある意味こっちのほうが自然なかんじはする…

![2047-2](/images/poj/2047-2.svg)

図は Sample Input の1つ目のケース．

また，どちらのグラフも多重辺を含んでいるため，[Spaghetti Source さんの Primal-Dual](http://www.prefield.com/algorithm/graph/primal_dual.html) をコピペしても解けない．
capacity, flow をエッジに持たせ，さらに各エッジに逆辺の情報を持たせることで，多重辺があっても動く Primal-Dual を書いた．

{% include_code lang:cpp poj/2047.cc %}
