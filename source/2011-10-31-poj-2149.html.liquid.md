---
layout: post
title: "POJ 2149 - Inherit the Spheres"
---
[http://poj.org/problem?id=2149](http://poj.org/problem?id=2149)

## 概要
三次元空間に N 個の球がある．

ある z0 に対して，z = z0 平面において，いくつの物体があるかに興味がある．
z0 を 0 から 36000 に動かしたとき，物体の個数の変化の様子を

- 増えたときに 1
- 減ったときに 0

で表したものを答える．

## 制約
- 1 <= N <= 100
- 1 <= 半径 R[i] <= 200
- 0 < X[i]-R[i] < X[i]+R[i] < 4000
- 0 < Y[i]-R[i] < Y[i]+R[i] < 16000
- 0 < Z[i]-R[i] < Z[i]+R[i] < 36000
- 球と球が1点で接していることはない
- Z[i]±R[i] および球同士の交差によって生じる円のz座標の最大値・最小値は互いに少なくとも 0.01 異なる

## 注意
- ある球が他の球を含んでいることがある

## 解法
個数が変わる可能性があるのは，制約にあるように

- Z[i]±R[i]
- 球同士の交差によって生じる円のz座標の最大値・最小値

の2種類なので，これらの z 座標をソートして各段階で何個の物体があるかどうか数えて変化を調べる．

まず球同士の交線について．
これを真面目に方程式で解こうとするとしんどいので，二分探索で求めることにする．
球の中心を結ぶ線分上で，どこが円の中心 z0 になるかを方程式から求めて，この z0 から上方向と下方向にそれぞれ，
その z で球を切ったときにちょうど切断面の円と円が接するところを二分探索で求める．

次にある z における物体の数について．
z で球を切って生じた円に対し，それぞれ交差判定をして Union-Find で数えればいい．

最初は

- Z[i]+R[i] で -1
- Z[i]-R[i] で +1
- 交線の上側で +1
- 交線の下側で -1

として，同じ z 座標になるようなものをうまくマージしてイベントドリブン風に解く方法を考えていた．
しかしこれだと3つ以上の球が交わっているようなとき，実際には +1 も -1 もされないような場合があって，それを弾く方法に自信がなかった．

{% include_code lang:cpp poj/2149.cc %}
